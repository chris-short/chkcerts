---
name: release

on:
  push:
    tags:
      - 'v*'

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
    build-release:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout ğŸ›
          uses: actions/checkout@v3
          with:
            fetch-depth: 0

        - name: Running govulncheck
          uses: Templum/govulncheck-action@v0.10.1
          with:
            github-token: ${{ secrets.GH_PAT }}

        - name: Set up Go âš™ï¸
          uses: actions/setup-go@v4
          with:
            go-version: '>=1.18.0'
            token: ${{ secrets.GH_PAT }}
            check-latest: true
        - run: go run certcheck.go https://chrisshort.net 90

        - name: Release Go binaries ğŸ
          uses: goreleaser/goreleaser-action@master
          with:
            version: latest
            args: release --clean
          env:
            GITHUB_TOKEN: ${{ secrets.GH_PAT }}